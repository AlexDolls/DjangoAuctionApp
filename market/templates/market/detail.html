{% extends "market/layout.html" %}
{% block body %}

    <script type = "text/javascript">


    </script>
    <div class="row">
        <!-- Alert -->
        {% if messages %}
            {% for message in messages%}
                <div class="alert alert-danger alert-dismissible bg-danger text-white border-0 fade show" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <strong>Error! </strong> {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <!-- Listing Details 1 -->
        <div class="col-md-15 col-lg-15">
            <div class="card">
                <div class="row no-gutters align-items-center">
                    <!-- Image -->
                    <div class="col-md-5">
                        <img class="card-img" src="{%if auctionlisting.loaded_image %}{{ auctionlisting.loaded_image.url }}{% else %}{{ auctionlisting.image }}{% endif %}" alt="{{ auctionlisting.id }}">
                    </div>

                    <!-- Details -->
                    <div class="col-md-6">
                        <div class="card-body">
                            <h2 class="card-title text-success">{{ auctionlisting.name }}</h2>

                            <!-- Edit, Add to Watchlist -->
                            {% if user.is_authenticated %}
                                {% if true_user %}
                                    <!-- Edit -->
                                    <a class="btn btn-primary btn-rounded float-right" href="{% url 'market:editListing' auctionlisting.id %}" id="edit-listing">Edit</a>
                                    {% else %}
                                    <!-- Add To Watchlist -->
                                    <form
                                        action="{% url "market:watchlist" %}" method="post">
                                        {% csrf_token %}
                                        <input type="hidden" name="listing_id" value={{ auctionlisting.id }}>
                                        {% if auctionlisting in user.watchlist.all %}
                                            <input type="submit" class="btn btn-primary btn-rounded float-right" id="add-listing-to-watchlist" value="Remove from watchlist">
                                        {% else %}
                                            <input type="submit" class="btn btn-primary btn-rounded float-right" id="add-listing-to-watchlist" value="Add to Watchlist">
                                        {% endif %}
                                    </form>
                                {% endif %}
                            {% endif %}

                            <!-- Description -->
                            <h4 class="card-title text-info">Description</h4>
                            <p class="card-text">
                                {% if auctionlisting.description %}
                                    {{ auctionlisting.description }}
                                {% else %}
                                    No description
                                {% endif %}
                            </p>

                            <!-- Table: User, Start Price, Creation Date, Expire Date -->
                            <h4 class="card-text text-info">Details</h4>
                            <table class="table table-striped table-centered mb-0">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Start Price</th>
                                        <th>Creation Date</th>
                                        <th>Expire Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>{{ auctionlisting.user }}</td>
                                        <td>${{ auctionlisting.startBid }}</td>
                                        <td>{{ auctionlisting.creationDate|date:'Y-m-d H:i' }}</td>
                                        <td>{{ auctionlisting.endDate|date:'Y-m-d H:i' }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Listing Details 2 -->
        <div class="col-md-15 col-lg-15">
            <div class="card">
                <div class="row no-gutters align-items-center">
                    <div class="col-md-15">
                        <div class="card-body">
                            <!-- Table: Time to close, Last Bid, Auto-Update, History -->
                            <table class="table table-centered mb-0">
                                <thead>
                                    <tr>
                                        <th>Time to Close</th>
                                        <th>Last Bid</th>
                                        <th>Auto Update</th>
                                        <th>History</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <!-- Hidden inputs to store dates -->
                                        <input type="hidden" id="listing-end-date" value="{{auctionlisting.endDate|date:'Y-m-d H:i:s'}}">
                                        <input type="hidden" id="server-date-now" value="{{server_datetime|date:'Y-m-d H:i:s'}}">
                                        <input type="hidden" id="listing-start-bid" value="{{ auctionlisting.startBid }}">
                                        <input type="hidden" id="is_active" value="{{ auctionlisting.active }}">

                                        <td id="countdown-box"></td>

                                        <td id="listing-last-bid">
                                            {% if bid is None %}
                                                No bids yet
                                            {% else %}
                                                ${{bid.value}}
                                            {% endif %}
                                        </td>
                                        <td>
                                            <!-- Switch-->
                                            <div>
                                                <input type="checkbox" id="autoupdate" checked data-switch="success"/>
                                                <label for="autoupdate" data-on-label="Yes" data-off-label="No" class="mb-0 d-block"></label>
                                            </div>
                                        </td>
                                        <td>
                                            <div id="history-button">
                                                <input type="hidden" id="is_open" value="0">
                                                <button type="button" id="history-btn" class="btn btn-primary btn-rounded" onclick="turn_is_open()">Show</button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <br>
                            <!-- Bid Alert -->
                            <div class="alert alert-danger alert-dismissible bg-danger text-white border-0 fade show" role="alert">
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <strong>Error - </strong> <span id="bid-warning"></span> simple danger alertâ€”check it out!
                            </div>

                            <!-- Winner, Make a bid -->
                            <input type="hidden" id="auction-listing-id" value="{{auctionlisting.id}}">
                            <table class="table table-centered mb-0">
                                <thead>
                                    <tr>
                                        {% if user.is_authenticated %}
                                            {% if not auctionlisting.active %}
                                                <th>Winner</th>
                                            {% endif %}

                                            {% if auctionlisting.active and user != auctionlisting.user %}
                                                <th>Make Bid</th>
                                            {% endif %}
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                    {% if user.is_authenticated %}
                                        {% if auctionlisting.active and user != auctionlisting.user %}
                                        <!-- Make Bid -->
                                        <td>
                                            <div class="input-group">
                                                <input type="hidden" id="last-bid" value="">
                                                <input type="number" class="form-control" value="{{ min_bid }}" min="{{ min_bid }}" max="99999" id="newbid" name="newbid">
                                                <div class="input-group-append">
                                                    <input class="btn btn-dark" id="new-bid-submit" type="button" value="Make a bid">
                                                </div>
                                            </div>
                                        </td>
                                        {% endif %}

                                        {% if not auctionlisting.active %}
                                            {% if auctionlisting in user.winlist.all %}
                                            <td>
                                                <span class="badge badge-primary-lighten">
                                                    Congratulations! You're the winner!
                                                </span>
                                            </td>
                                            {% else %}
                                            <td>
                                                <span id='result'>{{ bid.user }}</span>
                                            </td>
                                            {% endif %}
                                        {% else %}
                                        {% endif %}
                                    {% endif %}
                                    </tr>
                                </tbody>
                            </table>
                            <div data-simplebar style="max-height: 250px;"></div>
                            <div class="row p-3" id="history-list"></div>
                        </div> <!-- end card-body-->
                    </div> <!-- end col -->
                </div> <!-- end row-->
            </div> <!-- end card-->
        </div> <!-- end col-->

        <!-- Comments -->
        <div class="col-md-15 col-lg-15">
            <div class="card">
                <div class="row no-gutters align-items-center">
                    <div class="col-md-15">
                        <div class="card-body">
                            <div class="tab-content">
                                <div class="tab-pane show active p-3" id="newpost">
                                    <table class="table table-centered  mb-0">
                                        <thead>
                                            <h3>Comments</h3>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <!-- Show all comments -->
                                                <td>
                                                    <div data-simplebar style="max-height: 250px; width: 400px;" id="comment-box">
                                                        {% for comment in comments %}
                                                            <div class="media">
                                                                {% if comment.user.avatar %}
                                                                    <img
                                                                        src="{{ comment.user.avatar.url }}"
                                                                        alt=""
                                                                        class="mr-2 rounded"
                                                                        height="32"
                                                                    />
                                                                    {% else %}
                                                                    <img
                                                                        src="https://www.meme-arsenal.com/memes/d0aea72a4f42092ccd20a17781d7df11.jpg"
                                                                        alt=""
                                                                        class="mr-2 rounded"
                                                                        height="32"
                                                                    />
                                                                {% endif %}
                                                                <div class="media-body">
                                                                    <h5 class="m-0">{{ comment.user.username }}</h5>
                                                                    <p class="text-muted mb-0"><small>{{ comment.date|date:"M d, h:i a" }}</small></p>
                                                                    <p class="my-1">{{comment.text}}</p>
                                                                </div>
                                                            </div>
                                                            <hr>
                                                        {% endfor %}
                                                    </div>
                                                </td>
                                                <!-- Make a comment -->
                                                {% if auctionlisting.active and user.is_authenticated %}
                                                    <td>
                                                        <div class="border rounded" style="width: 400px;">
                                                            <form action="#" class="comment-area-box">
                                                                <textarea id="comment-input" rows="4" class="form-control border-0 resize-none" placeholder="Write something...."></textarea>
                                                                <div class="p-2 bg-light d-flex justify-content-between align-items-center">
                                                                    <div>
                                                                        <a href="#" class="btn btn-sm px-2 font-16 btn-light"><i class="uil uil-scenery"></i></a>
                                                                        <a href="#" class="btn btn-sm px-2 font-16 btn-light"><i class="uil uil-location"></i></a>
                                                                        <a href="#" class="btn btn-sm px-2 font-16 btn-light"><i class="uil uil-paperclip"></i></a>
                                                                    </div>
                                                                    <button id="comment-submit" type="submit" class="btn btn-sm btn-success"><i class="uil uil-message mr-1"></i>Comment</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                        </br>
                                                        <div class="custom-control custom-checkbox mb-2">
                                                            <input type="checkbox" class="custom-control-input" id="autoscroll-check" checked>
                                                            <label class="custom-control-label" for="autoscroll-check">Autoscroll</label>
                                                        </div>
                                                    </td>
                                                {% else %}
                                                    <td><h4>Login to make a comment...</h4></td>
                                                {% endif %}
                                            </tr>
                                        </tbody>
                                    </table>
                                </div> <!-- end preview-->
                            </div>
                        </div> <!-- end card-body-->
                    </div> <!-- end col -->
                </div> <!-- end row-->
            </div> <!-- end card-->
        </div> <!-- end col-->
    </div>

    {% if messages %}
		<ul class="messages">
			{% for message in messages%}
			<li {% if message.tags %} class="{{message.tags}}" {% endif %}> {{ message }}</li>
			{% endfor %}
		</ul>
	{% endif %}
	<p>

	<script>

	</script>

	<script type = 'text/javascript'>


	</script>


    </fieldset>
        {% if user == auctionlisting.user and not auctionlisting.active %}
        <form action = "{% url "market:removeListing" %}" method = "post" class = "add-category-left" style="z-index:1;">
        {% csrf_token %}
                <input type = "hidden" name = "listing_id" value = {{ auctionlisting.id }}>
                <input type = "submit" class = "btn-danger btn-lg" id = "delete-listing" value = "Delete Listing">
        </form>
        {% endif %}
        </center>
{% endblock %}
